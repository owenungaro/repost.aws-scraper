{
  "body": "I am setting up app streaming with active directory services following along with this\ntutorial\n.\nI am using IAM Identity Center as the identity provider, and an AWS Managed Microsoft AD for the directory.\nAfter completing these steps, I can\naccess the application portal associated the identity provider by logging in with a user from the active directory\nclick on the application linked to my AppStream 2.0 stack\nselect either 'Continue with browser' or 'Open AppStream 2.0 client'\nHowever, then I am given the error\nUnable to authorize the session. (Error Code: INVALID_AUTH_POLICY);Status Code:401\n.\nI have attached the trust policy, the inline policy, and the relay status below.\nNote that, if I remove the condition from the trust policy, then I do not get the error and can connect without issue.\nI don't think I want to do that though xD\nPlease let me know if there is any more information that would be helpful.\nThanks :)\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Principal\": {\n                \"Federated\": \"arn:aws:iam::0123456789:saml-provider/identity-provider\"\n            },\n            \"Action\": \"sts:AssumeRoleWithSAML\",\n            \"Condition\": {\n                \"StringEquals\": {\n                    \"SAML:sub_type\": \"persistent\"\n                }\n            }\n        }\n    ]\n}\n{\n\t\"Version\": \"2012-10-17\",\n\t\"Statement\": [\n\t\t{\n\t\t\t\"Effect\": \"Allow\",\n\t\t\t\"Action\": \"appstream:Stream\",\n\t\t\t\"Resource\": \"arn:aws:appstream:eu-west-2:0123456789:stack/stack-name\",\n\t\t\t\"Condition\": {\n\t\t\t    \"StringEquals\": {\n\t\t\t        \"appstream:userId\": \"{saml:sub}\"\n\t\t\t    }\n\t\t\t}\n\t\t}\n\t]\n}\nhttps://appstream2.euc-sso.eu-west-2.aws.amazon.com/saml?stack=stack-name&accountId=0123456789\n\nThere is a missing $ in the line \"appstream:userId\": \"{saml:sub}\" of the inline policy.\nIt should read \"appstream:userId\": \"${saml:sub}\"."
}