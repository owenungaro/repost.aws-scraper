{
  "body": "This guide addresses managing service-linked roles and Customer Profiles domains in Amazon Connect, focusing on resolving persistent service-linked role issues after instance deletion. Written for AWS administrators and DevOps engineers, it provides CLI and console-based solutions, along with best practices for maintaining clean AWS environments and preventing resource management issues.\n\nIntroduction\nAmazon Connect administrators often need to manage service-linked roles when working with Customer Profiles. This guide provides best practices and step-by-step instructions for managing these roles, particularly focusing on proper cleanup after instance deletion.\nTable of Contents\nUnderstanding the Architecture\nIdentifying Service-Linked Roles\nSolution Methods\nStep-by-Step Removal Process\nPreventive Measures\nTroubleshooting\nBest Practices\n1. Understanding the Architecture\nCustomer Profiles Domain Structure\nCustomer Profiles domains operate independently of Connect instances\nEach domain has its own service-linked role\nDomains can be associated with multiple instances\nService-Linked Role Purpose\nRole Name Format: AWSServiceRoleForProfile\nPrimary Purpose: Enables Customer Profiles to interact with other AWS services\nPermissions: Pre-defined by AWS for specific service interactions\nHere's the next section:\n2. Identifying Service-Linked Roles\nUsing AWS Management Console\nOpen AWS Management Console\nNavigate to IAM Console\nSelect \"Roles\" from the left navigation\nSearch for \"AWSServiceRoleForProfile\"\nUsing AWS CLI\n# List service-linked roles for Customer Profiles\naws iam list-roles --path-prefix\n\"/aws-service-role/profile.amazonaws.com/\"\n3. Solution Methods\nMethod 1: AWS CLI Approach\nAdvantages:\nAutomated execution\nEfficient for multiple domains\nSuitable for scripted operations\nMethod 2: Console Approach\nAdvantages:\nVisual interface\nReal-time feedback\nRecommended for single operations\n4. Step-by-Step Removal Process\nUsing AWS CLI\nConfigure AWS CLI\naws configure\nList Domains\naws customer-profiles list-domains --region\n<\nregion\n>\nDelete Domain\naws customer-profiles delete-domain\n\\\n--domain-name\n<\ndomain-name\n>\n\\\n--region\n<\nregion\n>\nVerify Removal\naws customer-profiles list-domains --region\n<\nregion\n>\nUsing AWS Console\nAccess Customer Profiles\nOpen Amazon Connect console\nNavigate to your instance\nSelect \"Customer Profiles\"\nDomain Management\nSelect existing domain\nReview associated instances\nVerify domain settings\nDomain Deletion Process\nSelect \"Delete domain\"\nReview impact warning:\nAgent access to customer information\nContact flow functionality\nCase management capabilities\nCampaign management features\nConfirm deletion\nWait for completion\nHere are the next sections:\n5. Preventive Measures\nPre-Deletion Checklist\nDocument domain configurations\nReview instance associations\nAssess business impact\nCreate backup if needed\nDocumentation Template\nEnvironment Details:\nInstance Region:\n<\nregion\n>\nDomain Information:\n-\nName:\n<\ndomain-name\n>\n-\nAssociated Instances:\n<\nnumber-of-instances\n>\nService-Linked Roles:\n-\nRole ARN:\n<\nrole-arn\n>\n6. Troubleshooting\nCommon Issues and Solutions\nDomain Deletion Failures\nIssue: Domain deletion not completing\nSolution:\nVerify no active instances are using the domain\nCheck for pending operations\nAllow 15 minutes between attempts\nRole Persistence\nIssue: Service-linked role remains after deletion\nSolution:\nConfirm domain deletion completion\nVerify no other domains use the role\nCheck AWS CloudTrail for related activities\nAccess Issues\nIssue: Insufficient permissions\nSolution:\nVerify IAM permissions include:\ncustomer-profiles:DeleteDomain\ncustomer-profiles:ListDomains\nCheck AWS Organizations policies\n7. Best Practices\nResource Management\nImplement standardized naming conventions\nMaintain resource inventory\nSchedule regular audits\nDocument dependencies\nSecurity Guidelines\nFollow principle of least privilege\nImplement resource tagging\nEnable AWS CloudTrail logging\nRegular security reviews\nOperational Excellence\nCreate runbooks for common tasks\nImplement monitoring:\nCloudWatch metrics\nResource usage alerts\nDeletion events\nMaintain change documentation\nHere are the final sections:\nConclusion\nEffective management of Customer Profiles service-linked roles in Amazon Connect requires understanding of AWS service relationships and careful attention to cleanup procedures. Following this guide's structured approach helps maintain a clean AWS environment and prevents common operational issues. Regular audits and proper documentation ensure long-term success in managing these resources.\nAdditional Resources\nAWS Official Documentation\nAmazon Connect Administrator Guide\nCustomer Profiles Documentation\nIAM Service-Linked Roles Guide\nAWS CLI References\nCustomer Profiles CLI Commands\nIAM CLI Commands\nBest Practice Guidelines\nBefore modifying Customer Profiles domains:\nReview current configurations\nAssess impact on:\nActive contact flows\nAgent workflows\nIntegration points\nCreate documentation for:\nConfiguration changes\nDependency mappings\nRecovery procedures\nImportant Notes\nAlways test procedures in a non-production environment\nMaintain detailed change logs\nFollow AWS security best practices\nKeep documentation current\nMonitor AWS service updates"
}