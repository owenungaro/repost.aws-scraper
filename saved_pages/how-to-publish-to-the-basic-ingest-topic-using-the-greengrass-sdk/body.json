{
  "body": "I am trying to use the greengrass IPC client sdk for js. To send a message to the basic ingest topic.\nawait this.ipcClient.publishToIoTCore({\n\t\t\t\t\ttopicName: `$aws/rules/${basicIngestRule}/${this.thingName}/${topic}`,\n\t\t\t\t\tqos,\n\t\t\t\t\tpayload: publishMessage,\n\t\t\t\t\tretain,\n\t\t\t\t});\nI get the error in the greengrass logs\n2025-06-04T05:45:01.660Z [ERROR] (AwsEventLoop 1) com.aws.greengrass.mqttclient.MqttClient: Failed to publish the message via Spooler and will retry. {reason=PUBACK:Topic can't start with $:c94e9e14-288a-99ed-35a0-6ffd767d695a, reasonCode=144}\n2025-06-04T05:45:01.946Z [INFO] (AwsEventLoop 1) com.aws.greengrass.mqttclient.MqttClient: Publishing message got a non-retryable reason code, not retrying. {reason=PUBACK:Topic can't start with $:edd5b852-7d60-0336-048c-ccf89ba2bb3d, topic=$aws/rules1/alertMessageIoTRule/100000004215d806/alerts/engine/1/fuelRate, reasonCode=144}\nHow do you publish directly to the basic ingest topic?\n\nIt appears that you're encountering an issue when trying to publish to a topic that starts with \"It appears that you're encountering an issue when trying to publish to a topic that starts with \"$\" using the AWS IoT Greengrass SDK. The error message suggests that topics starting with \"$\" are not allowed for direct publishing.\nTo publish to the basic ingest topic for AWS IoT Core rules, you should not include the \"$aws/rules/\" prefix in your topic name when using the Greengrass SDK. Instead, you should publish to the topic without this prefix.\nTry modifying your code to remove the \"$aws/rules/\" part from the topic name:\nawait\nthis\n.\nipcClient\n.\npublishToIoTCore\n(\n{\ntopicName\n:\n`\n${\nbasicIngestRule\n}\n/\n${\nthis\n.\nthingName\n}\n/\n${\ntopic\n}\n`\n,\nqos\n,\npayload\n:\npublishMessage\n,\nretain\n,\n}\n)\n;\nThis should allow you to publish to the intended topic without encountering the error about topics starting with \"$\".\nRemember that the AWS IoT Core rules engine will still process messages published to this topic as if they were published to the full basic ingest topic (including the \"$aws/rules/\" prefix). The Greengrass core handles the routing of these messages to the appropriate AWS IoT Core topic behind the scenes.\nIf you're still experiencing issues, make sure that your Greengrass component has the necessary permissions to publish to IoT Core topics. You may need to check your component's authorization policy to ensure it has the correct permissions for the \"aws.greengrass#PublishToIoTCore\" operation.quot; using the AWS IoT Greengrass SDK. The error message suggests that topics starting with \"It appears that you're encountering an issue when trying to publish to a topic that starts with \"$\" using the AWS IoT Greengrass SDK. The error message suggests that topics starting with \"$\" are not allowed for direct publishing.\nTo publish to the basic ingest topic for AWS IoT Core rules, you should not include the \"$aws/rules/\" prefix in your topic name when using the Greengrass SDK. Instead, you should publish to the topic without this prefix.\nTry modifying your code to remove the \"$aws/rules/\" part from the topic name:\nawait\nthis\n.\nipcClient\n.\npublishToIoTCore\n(\n{\ntopicName\n:\n`\n${\nbasicIngestRule\n}\n/\n${\nthis\n.\nthingName\n}\n/\n${\ntopic\n}\n`\n,\nqos\n,\npayload\n:\npublishMessage\n,\nretain\n,\n}\n)\n;\nThis should allow you to publish to the intended topic without encountering the error about topics starting with \"$\".\nRemember that the AWS IoT Core rules engine will still process messages published to this topic as if they were published to the full basic ingest topic (including the \"$aws/rules/\" prefix). The Greengrass core handles the routing of these messages to the appropriate AWS IoT Core topic behind the scenes.\nIf you're still experiencing issues, make sure that your Greengrass component has the necessary permissions to publish to IoT Core topics. You may need to check your component's authorization policy to ensure it has the correct permissions for the \"aws.greengrass#PublishToIoTCore\" operation.quot; are not allowed for direct publishing.\nTo publish to the basic ingest topic for AWS IoT Core rules, you should not include the \"$aws/rules/\" prefix in your topic name when using the Greengrass SDK. Instead, you should publish to the topic without this prefix.\nTry modifying your code to remove the \"$aws/rules/\" part from the topic name:\nawait\nthis\n.\nipcClient\n.\npublishToIoTCore\n(\n{\ntopicName\n:\n`\n${\nbasicIngestRule\n}\n/\n${\nthis\n.\nthingName\n}\n/\n${\ntopic\n}\n`\n,\nqos\n,\npayload\n:\npublishMessage\n,\nretain\n,\n}\n)\n;\nThis should allow you to publish to the intended topic without encountering the error about topics starting with \"It appears that you're encountering an issue when trying to publish to a topic that starts with \"$\" using the AWS IoT Greengrass SDK. The error message suggests that topics starting with \"$\" are not allowed for direct publishing.\nTo publish to the basic ingest topic for AWS IoT Core rules, you should not include the \"$aws/rules/\" prefix in your topic name when using the Greengrass SDK. Instead, you should publish to the topic without this prefix.\nTry modifying your code to remove the \"$aws/rules/\" part from the topic name:\nawait\nthis\n.\nipcClient\n.\npublishToIoTCore\n(\n{\ntopicName\n:\n`\n${\nbasicIngestRule\n}\n/\n${\nthis\n.\nthingName\n}\n/\n${\ntopic\n}\n`\n,\nqos\n,\npayload\n:\npublishMessage\n,\nretain\n,\n}\n)\n;\nThis should allow you to publish to the intended topic without encountering the error about topics starting with \"$\".\nRemember that the AWS IoT Core rules engine will still process messages published to this topic as if they were published to the full basic ingest topic (including the \"$aws/rules/\" prefix). The Greengrass core handles the routing of these messages to the appropriate AWS IoT Core topic behind the scenes.\nIf you're still experiencing issues, make sure that your Greengrass component has the necessary permissions to publish to IoT Core topics. You may need to check your component's authorization policy to ensure it has the correct permissions for the \"aws.greengrass#PublishToIoTCore\" operation.quot;.\nRemember that the AWS IoT Core rules engine will still process messages published to this topic as if they were published to the full basic ingest topic (including the \"$aws/rules/\" prefix). The Greengrass core handles the routing of these messages to the appropriate AWS IoT Core topic behind the scenes.\nIf you're still experiencing issues, make sure that your Greengrass component has the necessary permissions to publish to IoT Core topics. You may need to check your component's authorization policy to ensure it has the correct permissions for the \"aws.greengrass#PublishToIoTCore\" operation.\nSources\nPublish/subscribe AWS IoT Core MQTT messages - AWS IoT Greengrass\nPublish/subscribe local messages - AWS IoT Greengrass\n\nI want to confirm that if following these instructions do you still get the benefit of the basic ingest topic and not incurring normal message charges?\nCan you please point to the documentation on this?\nTesting it in the console I can publish to the topic of $aws/rules/.... and it works as intended. when I publish to ${basicIngestRule}/${this.thingName}/${topic}\nit does not trigger my rule\n\nHi,\nWe have some examples to refer in this document:\nhttps://docs.aws.amazon.com/greengrass/v2/developerguide/ipc-iot-core-mqtt.html\n, an important configuration you should configure in your deployment is\naccessControl\nMay we confirm we've already configured that and the operation\n\"aws.greengrass#PublishToIoTCore\",           \"aws.greengrass#SubscribeToIoTCore\"\nis\nToIoTCore\nIf this still doesn't work, could you provide full logs and mask the sensitive data please?\nThanks"
}