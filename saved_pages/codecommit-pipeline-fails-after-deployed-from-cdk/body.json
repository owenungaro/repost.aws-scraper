{
  "body": "We have an infrastructure policy in our organisation which handles roles and policies for users and their groups. Up until a week ago it was working fine, all of a suden we got an error of\nCompileError: WebAssembly.Module(): invalid value type 'externref', enable with --experimental-wasm-reftypes @+139\nFull error:\n[Container] 2025/06/10 07:38:43.823217 Entering phase INSTALL\n[Container] 2025/06/10 07:38:44.010047 Running command npm install -g aws-cdk@2\nnpm WARN EBADENGINE Unsupported engine {\nnpm WARN EBADENGINE   package: 'aws-cdk@2.1018.0',\nnpm WARN EBADENGINE   required: { node: '>= 18.0.0' },\nnpm WARN EBADENGINE   current: { node: 'v16.20.2', npm: '8.19.4' }\nnpm WARN EBADENGINE }\n\nadded 1 package, and audited 2 packages in 2s\n\nfound 0 vulnerabilities\n\n[Container] 2025/06/10 07:38:57.567134 Phase complete: INSTALL State: SUCCEEDED\n[Container] 2025/06/10 07:38:57.567159 Phase context status code:  Message: \n[Container] 2025/06/10 07:38:57.600748 Entering phase PRE_BUILD\n[Container] 2025/06/10 07:38:57.602280 Phase complete: PRE_BUILD State: SUCCEEDED\n[Container] 2025/06/10 07:38:57.602304 Phase context status code:  Message: \n[Container] 2025/06/10 07:38:57.635095 Entering phase BUILD\n[Container] 2025/06/10 07:38:57.636458 Running command cdk -a . deploy ProdPoliciesInfrastructureStack --require-approval=never --verbose\n/usr/local/lib/node_modules/aws-cdk/lib/index.js:318057\n    var wasmModule = new WebAssembly.Module(bytes);\n                     ^\n\nCompileError: WebAssembly.Module(): invalid value type 'externref', enable with --experimental-wasm-reftypes @+139\n    at ../../node_modules/cdk-from-cfn/index.js (/usr/local/lib/node_modules/aws-cdk/lib/index.js:318057:22)\n    at __require (/usr/local/lib/node_modules/aws-cdk/lib/index.js:17:50)\n    at lib/commands/migrate.ts (/usr/local/lib/node_modules/aws-cdk/lib/index.js:319064:28)\n    at __init (/usr/local/lib/node_modules/aws-cdk/lib/index.js:14:56)\n    at lib/cli/cdk-toolkit.ts (/usr/local/lib/node_modules/aws-cdk/lib/index.js:319350:5)\n    at __init (/usr/local/lib/node_modules/aws-cdk/lib/index.js:14:56)\n    at lib/cli/cli.ts (/usr/local/lib/node_modules/aws-cdk/lib/index.js:355329:5)\n    at __init (/usr/local/lib/node_modules/aws-cdk/lib/index.js:14:56)\n    at Object.<anonymous> (/usr/local/lib/node_modules/aws-cdk/lib/index.js:355577:14)\n    at Module._compile (node:internal/modules/cjs/loader:1198:14)\n\n[Container] 2025/06/10 07:38:58.559497 Command did not exit successfully cdk -a . deploy ProdPoliciesInfrastructureStack --require-approval=never --verbose exit status 1\n[Container] 2025/06/10 07:38:58.562876 Phase complete: BUILD State: FAILED\n[Container] 2025/06/10 07:38:58.562892 Phase context status code: COMMAND_EXECUTION_ERROR Message: Error while executing command: cdk -a . deploy ProdPoliciesInfrastructureStack --require-approval=never --verbose. Reason: exit status 1\n[Container] 2025/06/10 07:38:58.597064 Entering phase POST_BUILD\n[Container] 2025/06/10 07:38:58.598907 Phase complete: POST_BUILD State: SUCCEEDED\n[Container] 2025/06/10 07:38:58.598921 Phase context status code:  Message: \n[Container] 2025/06/10 07:38:58.662763 Set report auto-discover timeout to 5 seconds\n[Container] 2025/06/10 07:38:58.662901 Expanding base directory path:  .\n[Container] 2025/06/10 07:38:58.665250 Assembling file list\n[Container] 2025/06/10 07:38:58.665265 Expanding .\n[Container] 2025/06/10 07:38:58.667702 Expanding file paths for base directory .\n[Container] 2025/06/10 07:38:58.667719 Assembling file list\n[Container] 2025/06/10 07:38:58.667723 Expanding **/*\n[Container] 2025/06/10 07:38:58.670351 No matching auto-discover report paths found\n[Container] 2025/06/10 07:38:58.670431 Report auto-discover file discovery took 0.007668 seconds\n[Container] 2025/06/10 07:38:58.670446 Phase complete: UPLOAD_ARTIFACTS State: SUCCEEDED\n[Container] 2025/06/10 07:38:58.670500 Phase context status code:  Message:\npackage.json:\n{\n  \"name\": \"nordic-annalect-policies-infrastructure\",\n  \"version\": \"0.1.0\",\n  \"bin\": {\n    \"nordic-annalect-policies-infrastructure\": \"bin/nordic-annalect-policies-infrastructure.js\"\n  },\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"watch\": \"tsc -w\",\n    \"test\": \"jest\",\n    \"cdk\": \"cdk\"\n  },\n  \"devDependencies\": {\n    \"@types/jest\": \"^29.4.4\",\n    \"@types/node\": \"^18.15.3\",\n    \"eslint\": \"^8.36.0\",\n    \"eslint-config-prettier\": \"^8.7.0\",\n    \"eslint-plugin-prettier\": \"^4.2.1\",\n    \"jest\": \"^29.5.0\",\n    \"prettier\": \"^2.8.4\",\n    \"ts-jest\": \"^29.0.5\",\n    \"ts-node\": \"^10.9.1\",\n    \"typescript\": \"^4.9.5\"\n  },\n  \"dependencies\": {\n    \"aws-cdk\": \"^2.69.0\",\n    \"aws-cdk-lib\": \"^2.69.0\",\n    \"constructs\": \"^10.1.279\",\n    \"electron-to-chromium\": \"^1.4.331\",\n    \"outdated\": \"^0.1.1\",\n    \"source-map-support\": \"^0.5.21\"\n  },\n  \"jest\": {\n    \"moduleFileExtensions\": [\n      \"js\"\n    ]\n  }\n}\nNot sure where this came from as we didn't update anything or added anything new. Can someone help me out on this one?\n\nThe error you're encountering is related to a Node.js version compatibility issue with the AWS CDK. The error message shows that you're using Node.js v16.20.2, but the AWS CDK version you're trying to use requires Node.js 18.0.0 or higher.\nThe specific error\nCompileError: WebAssembly.Module(): invalid value type 'externref', enable with --experimental-wasm-reftypes @+139\nis occurring because newer versions of the CDK use WebAssembly features that are not supported in Node.js 16.\nThere are a few ways to resolve this issue:\nUpgrade the Node.js version in your build environment to version 18 or higher. This is the recommended approach since your package.json shows you're using AWS CDK v2.69.0 which requires Node.js 18+.\nIf you can't upgrade Node.js, you could try pinning to an older version of the CDK that's compatible with Node.js 16. However, this is not recommended as a long-term solution.\nUpdate your CodeBuild project configuration to use a newer runtime that includes Node.js 18+.\nThe warning in your logs clearly indicates this compatibility issue:\nnpm WARN EBADENGINE Unsupported engine {\npackage: 'aws-cdk@2.1018.0',\nrequired: { node: '>= 18.0.0' },\ncurrent: { node: 'v16.20.2', npm: '8.19.4' }\n}\nThis is a common issue when the CDK is updated but the build environment isn't updated to match the new requirements.\nSources\nProblem: Core pipeline failure - Landing Zone Accelerator on AWS"
}