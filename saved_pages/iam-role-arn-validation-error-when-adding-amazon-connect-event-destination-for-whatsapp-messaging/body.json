{
  "body": "I am attempting to configure a WhatsApp Business phone number in AWS End User Messaging (Social messaging) and integrate it with Amazon Connect for event destinations.\nWhen I try to add Amazon Connect as an event destination and provide an IAM role ARN, I encounter the following validation error:\n1 validation error detected: Value 'arn:aws:iam::099437942532:role/aws-service-role/connect.amazonaws.com/AWSServiceRoleForAmazonConnect_Whatsapp_Messaging' at 'setupFinalization.waba.eventDestinations.1.member.roleArn' failed to satisfy constraint: Member must satisfy regular expression pattern: arn:aws:iam::\\d{12}:role\\/[a-zA-Z0-9+=,.@\\-_]+ RequestId: 1f6997a7-872b-4284-a7ff-6bf0c92bd59c HttpStatusCode: 400\nContext\nI am in the AWS End User Messaging service, navigating to Social messaging -> WhatsApp: Business accounts -> Add WhatsApp phone number.\nThe ARN I'm trying to use arn:aws:iam::099437942532:role/aws-service-role/connect.amazonaws.com/AWSServiceRoleForAmazonConnect_Whatsapp_Messaging\nMy Understanding/Attempted Fix:\nMy initial understanding was that the AWSServiceRoleForAmazonConnect_Whatsapp_Messaging (my created service-linked role), along with its associated AmazonConnectServiceLinkedRolePolicy would be sufficient for setting up the event destination. However, the validation error suggests that the provided ARN does not match the expected regular expression pattern for a standard IAM role, leading me to believe that the service might expect a custom IAM role for this configuration.\nMy Question:\nIs my understanding correct that I need to create a custom IAM role instead of using a service-linked role for the \"Two-way channel role\" or \"Event Destination\" when integrating WhatsApp Business with Amazon Connect in AWS End User Messaging?\nIf so, what are the minimum required IAM permissions (actions and resources) that this custom role needs to have for Amazon Connect to successfully act as an event destination for WhatsApp messaging?\nAre there any specific trust policy configurations required for this custom role to allow Amazon Connect to assume it?\nAny guidance or example IAM policies would be greatly appreciated.\n\nBased on the validation error you're encountering, you're correct that you need to create a custom IAM role rather than using a service-linked role for the WhatsApp Business integration with Amazon Connect.\nThe error message indicates that the ARN format you're using doesn't match the expected pattern. The pattern requires a standard IAM role ARN format:\narn:aws:iam::\\d{12}:role/[a-zA-Z0-9+=,.@\\-_]+\n. Your current ARN includes additional path segments (\naws-service-role/connect.amazonaws.com/\n) which don't match this pattern.\nTo resolve this issue:\nCreate a custom IAM role with a direct path (without the service-role path segments)\nFor the trust policy, you'll need to allow the SMS and voice service to assume the role:\n{\n\"Version\": \"2012-10-17\",\n\"Statement\": [\n{\n\"Sid\": \"SMSVoice\",\n\"Effect\": \"Allow\",\n\"Principal\": {\n\"Service\": \"sms-voice.amazonaws.com\"\n},\n\"Action\": \"sts:AssumeRole\",\n\"Condition\": {\n\"StringEquals\": {\n\"aws:SourceAccount\": \"YOUR_ACCOUNT_ID\"\n}\n}\n}\n]\n}\nFor the permissions policy, you'll need to grant permissions for the role to import phone numbers and write events. The exact permissions will depend on your specific use case, but at minimum, you'll need permissions to handle the WhatsApp message events and integrate with Amazon Connect.\nWhen creating this role, make sure:\nThe role name follows the pattern of allowed characters: alphanumeric characters and these special characters: +=,.@-_\nThe role is created directly under your account (not in a service-role path)\nThe appropriate trust relationship is established to allow the necessary AWS services to assume the role\nSources\nValidation error when trying to enable TwoWay Message with Amazon Connect in Pinpoint | AWS re:Post\nWhatsAppBusinessAccountEventDestination - AWS End User Messaging Social\nIAM policy validation check reference - AWS Identity and Access Management"
}